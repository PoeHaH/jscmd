String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}); var cmd=function(){var g={sandbox:!0,height:250,showHints:!0,inputFirst:!0},k=function(e){function d(a){function b(a){if("object"===typeof a){if(-1!==d.indexOf(a))return!0;d.push(a);for(var h in a)if(a.hasOwnProperty(h)&&b(a[h]))return!0}return!1}var d=[];return b(a)}var b=null,f=[],c=-1,a=-1;this.getPreviousCommand=function(){var a=f[c==f.length-1?c:c-1];"undefined"!==typeof a&&c--;return a};this.getNextCommand=function(){var a=f[c+1];"undefined"!==typeof a&&c++;return a||""};this.addCommand=function(b){this.getPreviousCommand()!= b&&(f.push(b),a++,a!=c&&(c=a))};this.processCommand=function(a){if(null!=b){a=a.trim();this.addCommand(a);try{!b.eval&&b.execScript&&b.execScript("null");var c=b.eval(a);a=typeof c;d(c)||"object"!==typeof JSON||"function"!==typeof JSON.stringify||(c=JSON.stringify(c));return{type:a,text:c}}catch(e){return{type:"error",text:e.name+": "+e.message,extra:e.stack}}}else throw Error("Can't perform command without a scope");};this.setScope=function(a){b=a};this.getScope=function(){return b}},l=function(e){var d= document.createElement("div"),b=document.createElement("textarea"),f=document.createElement("div"),c=null;d.className="cmd-container";f.className="cmd-window";f.style.height=e.height+"px";b.className="cmd-input";b.setAttribute("rows",1);b.value="> ";b.setAttribute("spellcheck","false");this.container=d;this.inputBox=b;this.consoleWindow=f;e.sandbox&&(c=document.createElement("iframe"),c.setAttribute("height","0"),c.style.visibility="hidden");this.sandbox=c;this.getInputvalue=function(){return this.inputBox.value}; this.setInputvalue=function(a){this.inputBox.value="> "+a};this.setInputHeight=function(){var a=this.inputBox.value.split(/\r\n|\r|\n/).length*parseInt(this.inputBox.getAttribute("data-h"));this.inputBox.style.height=a+"px"};this.appendResult=function(a){var b=document.createElement("span");b.className="cmd-line";b.className+=" cmd-"+a.type;b.style.display="block";b.innerHTML=a.text;"error"==a.type&&"undefined"!==typeof a.extra&&b.setAttribute("title",a.extra);this.consoleWindow.insertBefore(b,this.consoleWindow.hasChildNodes()? this.consoleWindow.childNodes[0]:null)};this.render=function(){e.inputFirst?(this.container.appendChild(this.inputBox),this.container.appendChild(this.consoleWindow)):(this.container.appendChild(this.consoleWindow),this.container.appendChild(this.inputBox));document.getElementById(e.container).appendChild(this.container);this.inputBox.setAttribute("data-h",this.inputBox.clientHeight);e.sandbox&&null!=this.sandbox&&document.body.appendChild(this.sandbox)}},m=function(e){var d=new k(e),b=new l(e);b.render(); d.setScope(window);null!=b.sandbox&&("undefined"===typeof b.sandbox.contentWindow.console&&(b.sandbox.contentWindow.console=window.console),d.setScope(b.sandbox.contentWindow));d.getScope().console.log=function(a){return null!=a&&"undefined"!==typeof a?a:null==a?a:typeof a};d.getScope().console.dir=function(a){if("object"===typeof a){var b="",c;for(c in a)b=null!=a[c]?b+(c+" : "+a[c].toString()+". "):b+(c+" : null. ");return d.getScope().console.log(b)}return d.getScope().console.log(a)};try{b.sandbox.contentWindow.parent= null}catch(f){}var c={38:"_upArrow",40:"_downArrow",13:"_enter"};b.inputBox.onkeydown=function(a){a=a||window.event;b.setInputHeight();38==a.keyCode&&(a.preventDefault?a.preventDefault():a.returnValue=!1);13!=a.keyCode||a.shiftKey||(a.preventDefault?a.preventDefault():a.returnValue=!1)};b.inputBox.onkeyup=function(a){a=a||window.event;switch(c[a.keyCode]){case "_enter":a.shiftKey||(a=b.getInputvalue().replace(/^>(\s)*/,""),b.setInputvalue(""),0<a.length&&b.appendResult(d.processCommand(a)));break; case "_upArrow":a=d.getPreviousCommand();"undefined"!==typeof a&&b.setInputvalue(a);break;case "_downArrow":a=d.getNextCommand();"undefined"!==typeof a&&b.setInputvalue(a);break;default:">"!=b.getInputvalue().substring(0,1)&&b.setInputvalue(b.getInputvalue())}b.setInputHeight()}};return{init:function(e){for(var d in e)g[d]=e[d];mainHints=setHints();new m(g)}}}();